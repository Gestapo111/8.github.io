<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluación Unidad 8: Clasificando a los Seres Vivos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .quiz-container {
            max-width: 800px;
            margin: auto;
        }
        .question {
            margin-bottom: 20px;
        }
        .question strong {
            display: block;
            margin-bottom: 10px;
        }
        .options {
            list-style: none;
            padding: 0;
        }
        .options li {
            margin-bottom: 10px;
        }
        #submit {
            margin-top: 20px;
        }
        #resultModal {
            display: none;
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        #resultModal .close {
            float: right;
            cursor: pointer;
        }
        #timer {
            font-size: 20px;
            font-weight: bold;
            color: green;
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <h2>Evaluación Unidad 8: Clasificando a los Seres Vivos</h2>
        <p>Nombre: <input type="text" id="fullname" required></p>
        <p>NIE: <input type="text" id="nie" required></p>
        <button id="startQuiz">Comenzar Evaluación</button>

        <div id="quiz" style="display: none;">
            <!-- Aquí se insertarán las preguntas -->
        </div>

        <div id="resultModal">
            <span class="close">X</span>
            <h2>Resultados</h2>
            <p id="modalName"></p>
            <p id="modalNIE"></p>
            <p id="modalDetails"></p>
            <p id="modalIncorrectAnswers"></p>
            <p id="attemptCount"></p>
            <p id="manipulationCount"></p>
            <button id="submit" disabled>Obtener Calificación</button>
        </div>
    </div>

    <div id="timer">30:00</div>

    <script>
        const quizData = [
            {
                question: "¿Qué impacto tiene la agricultura intensiva en la biodiversidad?",
                answers: [
                    { text: "Destruye hábitats naturales y reduce la diversidad de especies.", correct: true },
                    { text: "Aumenta la diversidad de especies en áreas agrícolas.", correct: false },
                    { text: "No afecta la biodiversidad.", correct: false },
                    { text: "Promueve la recuperación de hábitats naturales.", correct: false }
                ]
            },
            {
                question: "¿Qué ecosistema en El Salvador se considera vulnerable debido a la deforestación?",
                answers: [
                    { text: "El bosque seco tropical.", correct: true },
                    { text: "El páramo andino.", correct: false },
                    { text: "El desierto de Sonora.", correct: false },
                    { text: "La tundra ártica.", correct: false }
                ]
            },
            {
                question: "¿Cómo afecta la caza furtiva a la biodiversidad en El Salvador?",
                answers: [
                    { text: "Disminuye las poblaciones de especies amenazadas.", correct: true },
                    { text: "No tiene ningún impacto en las poblaciones de especies.", correct: false },
                    { text: "Aumenta la diversidad genética de las especies.", correct: false },
                    { text: "Contribuye a la recuperación de especies.", correct: false }
                ]
            },
            {
                question: "¿Qué nivel de diversidad biológica se relaciona con la variación en el paisaje, incluyendo diferentes tipos de hábitats?",
                answers: [
                    { text: "Diversidad de paisajes.", correct: true },
                    { text: "Diversidad de especies.", correct: false },
                    { text: "Diversidad genética.", correct: false },
                    { text: "Diversidad de ecosistemas.", correct: false }
                ]
            },
            {
                question: "¿Qué impacto tiene la conversión de tierras agrícolas en la biodiversidad?",
                answers: [
                    { text: "Reduce la diversidad de hábitats disponibles para las especies.", correct: true },
                    { text: "Crea nuevos hábitats para especies nativas.", correct: false },
                    { text: "Aumenta la diversidad de especies.", correct: false },
                    { text: "No afecta la biodiversidad.", correct: false }
                ]
            },
            {
                question: "¿Cómo afecta la fragmentación del hábitat a la biodiversidad en El Salvador?",
                answers: [
                    { text: "Aísla poblaciones de especies, lo que puede llevar a la extinción local.", correct: true },
                    { text: "Aumenta la conectividad entre poblaciones de especies.", correct: false },
                    { text: "No afecta la biodiversidad.", correct: false },
                    { text: "Facilita la migración de especies entre hábitats.", correct: false }
                ]
            },
            {
                question: "¿Cuál de los siguientes paisajes de El Salvador está bajo amenaza debido a la actividad humana?",
                answers: [
                    { text: "Los manglares.", correct: true },
                    { text: "Las playas de arena blanca.", correct: false },
                    { text: "Las montañas de niebla.", correct: false },
                    { text: "Las áreas desérticas.", correct: false }
                ]
            },
            {
                question: "¿Qué nivel de diversidad es crucial para la agricultura sostenible?",
                answers: [
                    { text: "Diversidad genética.", correct: true },
                    { text: "Diversidad de especies.", correct: false },
                    { text: "Diversidad de ecosistemas.", correct: false },
                    { text: "Diversidad de paisajes.", correct: false }
                ]
            },
            {
                question: "¿Cómo afecta la pérdida de la diversidad biológica a los ecosistemas?",
                answers: [
                    { text: "Reduce la capacidad del ecosistema para recuperarse de perturbaciones.", correct: true },
                    { text: "Mejora la capacidad del ecosistema para mantener la biodiversidad.", correct: false },
                    { text: "Aumenta la estabilidad y resiliencia del ecosistema.", correct: false },
                    { text: "No tiene efecto en la estabilidad del ecosistema.", correct: false }
                ]
            },
            {
                question: "¿Qué término se usa para describir un ecosistema que ha sido alterado pero aún mantiene su función ecológica?",
                answers: [
                    { text: "Ecosistema alterado.", correct: true },
                    { text: "Ecosistema resiliente.", correct: false },
                    { text: "Ecosistema degradado.", correct: false },
                    { text: "Ecosistema colapsado.", correct: false }
                ]
            },
            // Añadir más preguntas según sea necesario
        ];

        const authorizedNIEs = [
            "4267837", "3850952", "3851018", "5032035", "19806181", "6297536", "2608724",
            "6262810", "4267838", "20162435", "3850923", "19806209", "4267828", "3850942"
        ];

        let attempt = 0;
        const maxAttempts = 2;
        const evaluationName = "Evaluación Unidad 8: Clasificando a los Seres Vivos";
        let timer;
        let timeLeft = 1800; // 30 minutos en segundos
        let startTime;
        let manipulationCount = 0;

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function loadQuiz() {
            const quizContainer = document.getElementById('quiz');
            quizContainer.innerHTML = '';
            
            // Shuffle questions and answers
            const shuffledQuizData = shuffle([...quizData]);
            shuffledQuizData.forEach((quizItem, quizIndex) => {
                const questionElement = document.createElement('div');
                questionElement.className = 'question';
                questionElement.innerHTML = `<strong>${quizIndex + 1}. ${quizItem.question}</strong>`;
                
                const optionsList = document.createElement('ul');
                optionsList.className = 'options';

                const shuffledAnswers = shuffle([...quizItem.answers]);
                shuffledAnswers.forEach((answer, answerIndex) => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `
                        <label>
                            <input type="radio" name="question${quizIndex}" value="${answer.correct}">
                            ${answer.text}
                        </label>`;
                    optionsList.appendChild(listItem);
                });

                questionElement.appendChild(optionsList);
                quizContainer.appendChild(questionElement);
            });
        }

        document.getElementById('startQuiz').addEventListener('click', () => {
            const fullname = document.getElementById('fullname').value.trim();
            const nie = document.getElementById('nie').value.trim();

            if (fullname && authorizedNIEs.includes(nie)) {
                document.getElementById('quiz').style.display = 'block';
                document.getElementById('startQuiz').style.display = 'none';

                startTimer();
                startTime = new Date();
            } else {
                alert('Por favor, ingresa un NIE válido o asegúrate de que tu nombre esté completo.');
            }
        });

        document.getElementById('submit').addEventListener('click', () => {
            const answerContainers = document.querySelectorAll('.quiz-container .question');
            let score = 0;
            let incorrectAnswers = [];

            answerContainers.forEach((container, index) => {
                const selectedOption = container.querySelector('input[type="radio"]:checked');
                if (selectedOption) {
                    const isCorrect = selectedOption.value === "true";
                    if (isCorrect) {
                        score++;
                    } else {
                        incorrectAnswers.push(index + 1);
                    }
                } else {
                    incorrectAnswers.push(index + 1);
                }
            });

            const endTime = new Date();
            const timeTaken = Math.floor((endTime - startTime) / 1000);

            const fullname = document.getElementById('fullname').value.trim();
            const nie = document.getElementById('nie').value.trim();
            const scorePercentage = (score / quizData.length) * 10;
            const formattedTimeTaken = `${Math.floor(timeTaken / 60)} minutos y ${timeTaken % 60} segundos`;

            // Show results in the modal
            document.getElementById('modalName').innerText = `Nombre: ${fullname}`;
            document.getElementById('modalNIE').innerText = `NIE: ${nie}`;
            document.getElementById('modalDetails').innerText = `Calificación obtenida: ${scorePercentage.toFixed(2)} / 10\nTiempo: ${formattedTimeTaken}\nUnidad: ${evaluationName}\nFecha: ${new Date().toLocaleString()}`;
            document.getElementById('modalIncorrectAnswers').innerHTML = incorrectAnswers.map(num => `<div>Pregunta ${num}</div>`).join('');
            document.getElementById('attemptCount').innerText = `Intento ${attempt + 1} de ${maxAttempts}`;
            document.getElementById('manipulationCount').innerText = `Intentos de manipulación detectados: ${manipulationCount}`;
            document.getElementById('resultModal').style.display = 'block';

            attempt++;
            if (attempt >= maxAttempts) {
                document.getElementById('submit').disabled = true;
            }
        });

        document.querySelector('.close').addEventListener('click', () => {
            document.getElementById('resultModal').style.display = 'none';
        });

        function startTimer() {
            timer = setInterval(() => {
                timeLeft--;
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    document.getElementById('submit').click();
                } else {
                    const minutes = Math.floor(timeLeft / 60);
                    const seconds = timeLeft % 60;
                    document.getElementById('timer').innerText = `${minutes}:${seconds < 10 ? '0' + seconds : seconds}`;
                    if (timeLeft <= 600 && timeLeft > 300) {
                        document.getElementById('timer').style.backgroundColor = 'orange';
                    } else if (timeLeft <= 300) {
                        document.getElementById('timer').style.backgroundColor = 'red';
                    }
                }
            }, 1000);
        }

        // Deshabilitar clic derecho
        document.addEventListener('contextmenu', (event) => event.preventDefault());

        // Deshabilitar copiar y pegar
        document.addEventListener('copy', (event) => event.preventDefault());
        document.addEventListener('paste', (event) => event.preventDefault());

        // Monitor de cambios sospechosos
        let originalQuizState = JSON.stringify([...document.querySelectorAll('input[type="radio"]')].map(input => input.checked));
        setInterval(() => {
            const currentQuizState = JSON.stringify([...document.querySelectorAll('input[type="radio"]')].map(input => input.checked));
            if (originalQuizState !== currentQuizState) {
                manipulationCount++;
                originalQuizState = currentQuizState;
            }
        }, 1000);

        // Cargar el cuestionario
        loadQuiz();
    </script>
</body>
</html>
